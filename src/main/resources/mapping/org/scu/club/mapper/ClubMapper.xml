<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.scu.club.mapper.ClubMapper">

  <insert id="insertClub"  useGeneratedKeys="true" keyProperty="id">
    INSERT INTO `club`
    (
    <trim suffixOverrides=",">
      <if test="type!=null">
        `type`,
      </if>
      <if test="name!=null">
        `name`,
      </if>
      <if test="teacherId!=null">
        `teacher_id`,
      </if>
      <if test="clubType!=null">
        `club_type`,
      </if>
      <if test="createTime!=null">
        `create_time`,
      </if>
      <if test="updateTime!=null">
        `update_time`,
      </if>
    </trim>
    )
    VALUES
    (
    <trim suffixOverrides=",">
      <if test="id!=null">
        #{id},
      </if>
      <if test="type!=null">
        #{type},
      </if>
      <if test="name!=null">
        #{name},
      </if>
      <if test="teacherId!=null">
        #{teacherId},
      </if>
      <if test="clubType!=null">
        #{clubType},
      </if>
      <if test="createTime!=null">
        #{createTime},
      </if>
      <if test="updateTime!=null">
        #{updateTime},
      </if>
    </trim>
    )
  </insert>


  <update id="updateClub">
    UPDATE `club`
    SET
    <trim suffixOverrides=",">
      <if test="type != null">
        `type` = #{type},
      </if>
      <if test="name != null and name!=''">
        `name` = #{name},
      </if>
      <if test="teacherId != null">
        `teacher_id` = #{teacherId},
      </if>
      <if test="clubType != null and clubType!=''">
        `club_type` = #{clubType},
      </if>
      <if test="createTime != null">
        `create_time` = #{createTime},
      </if>
      <if test="updateTime != null">
        `update_time` = #{updateTime},
      </if>
    </trim>
    WHERE
    <trim suffixOverrides="and">
      `id` = #{id} and
    </trim>
  </update>

  <resultMap type="org.scu.club.vo.VClub" id="ClubMap">
    <result property="id" column="id"/>
    <result property="name" column="name"/>
    <result property="teacherId" column="teacher_id"/>
    <result property="clubType" column="club_type"/>
    <result property="teacherName" column="teacher_name"/>
    <result property="clubTypeName" column="club_type_name"/>
    <result property="createTime" column="create_time"/>
    <result property="updateTime" column="update_time"/>
  </resultMap>

  <select id="listClubs" parameterType="org.scu.club.vo.QClub" resultMap="ClubMap">
    select
      <include refid="allResult"></include>
    from  club, club_type, teacher
    where
      club.club_type = club_type.id
    AND
      club.teacher_id = teacher.id
    <if test="name != null and name!=''">
      AND `name` = #{name},
    </if>
    limit #{startRecord}, #{endRecord}
  </select>

  <select id="getClub" parameterType="int" resultMap="ClubMap">
    select
    <include refid="allResult"></include>
    from  club, club_type, teacher
    where
    club.club_type = club_type.id
    AND
    club.teacher_id = teacher.id
    AND
    club.id = #{id}
  </select>

  <sql id="allResult">
    <trim suffixOverrides=",">
      club.`id`,
      club.`name`,
      club.`teacher_id`,
      club.`club_type`,
      club_type.`name` club_type_name,
      teacher.`name` teacher_name,
      club.`create_time`,
      club.`update_time`,
    </trim>
  </sql>

  <update id="updateVipStatus">
    UPDATE
    club_student_mapping
    SET
      status = 1
    WHERE
      club_id = #{clubId}
    AND
      student_id = #{studentId}
  </update>

</mapper>